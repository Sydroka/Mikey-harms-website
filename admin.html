<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mikey Harms Admin</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Alata&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-size: 62.5%;
      }

      body {
        font-family: "Alata", sans-serif;
        background: #0a0a0a;
        color: #fff;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .admin-container {
        width: 100%;
        max-width: 60rem;
        padding: 2.4rem;
      }

      .admin-logo {
        text-align: center;
        font-size: 3.2rem;
        font-weight: 700;
        color: #f02e2e;
        margin-bottom: 4rem;
        letter-spacing: 2px;
      }

      .login-box {
        background: #1a1a1a;
        border-radius: 16px;
        padding: 4rem;
        text-align: center;
      }

      .login-box h2 {
        font-size: 2.4rem;
        margin-bottom: 3.2rem;
        color: #fff;
      }

      .login-input {
        width: 100%;
        padding: 1.6rem 2rem;
        font-size: 1.8rem;
        border-radius: 8px;
        border: 2px solid #333;
        background: #111;
        color: #fff;
        margin-bottom: 1.6rem;
        font-family: inherit;
      }

      .login-input:focus {
        outline: none;
        border-color: #f02e2e;
      }

      .login-btn {
        width: 100%;
        padding: 1.6rem;
        background: #f02e2e;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 1.8rem;
        font-weight: 600;
        cursor: pointer;
        font-family: inherit;
        transition: background 0.3s;
      }

      .login-btn:hover {
        background: #c02020;
      }

      .login-error {
        color: #f02e2e;
        font-size: 1.4rem;
        margin-top: 1.2rem;
        display: none;
      }

      .dashboard {
        display: none;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 3.2rem;
      }

      .dashboard-header h2 {
        font-size: 2.4rem;
      }

      .logout-btn {
        padding: 0.8rem 1.6rem;
        background: transparent;
        color: #888;
        border: 1px solid #333;
        border-radius: 6px;
        font-size: 1.4rem;
        cursor: pointer;
        font-family: inherit;
        transition: all 0.3s;
      }

      .logout-btn:hover {
        color: #fff;
        border-color: #666;
      }

      .visitor-card {
        background: #1a1a1a;
        border-radius: 16px;
        padding: 3.2rem;
        margin-bottom: 2.4rem;
        display: flex;
        align-items: center;
        gap: 2.4rem;
      }

      .visitor-icon {
        font-size: 4rem;
      }

      .visitor-info h3 {
        font-size: 1.4rem;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 0.8rem;
      }

      .visitor-count {
        font-size: 4.8rem;
        font-weight: 700;
        color: #f02e2e;
      }

      .visitor-label {
        font-size: 1.4rem;
        color: #666;
        margin-top: 0.4rem;
      }

      .live-card {
        background: #1a1a1a;
        border-radius: 16px;
        padding: 3.2rem;
        margin-bottom: 2.4rem;
      }

      .live-card h3 {
        font-size: 1.8rem;
        margin-bottom: 2.4rem;
        color: #fff;
      }

      .platform-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.6rem 0;
        border-bottom: 1px solid #222;
      }

      .platform-row:last-of-type {
        border-bottom: none;
      }

      .platform-info {
        display: flex;
        align-items: center;
        gap: 1.6rem;
      }

      .platform-icon {
        font-size: 2.8rem;
      }

      .platform-name {
        font-size: 1.8rem;
        font-weight: 600;
      }

      .toggle-switch {
        position: relative;
        width: 6rem;
        height: 3.2rem;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #333;
        border-radius: 3.2rem;
        transition: 0.3s;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 2.4rem;
        width: 2.4rem;
        left: 0.4rem;
        bottom: 0.4rem;
        background: #fff;
        border-radius: 50%;
        transition: 0.3s;
      }

      input:checked + .toggle-slider {
        background: #f02e2e;
      }

      input:checked + .toggle-slider:before {
        transform: translateX(2.8rem);
      }

      .youtube-card {
        background: #1a1a1a;
        border-radius: 16px;
        padding: 3.2rem;
        margin-bottom: 2.4rem;
      }

      .youtube-card h3 {
        font-size: 1.8rem;
        margin-bottom: 0.8rem;
      }

      .youtube-card p {
        font-size: 1.4rem;
        color: #888;
        margin-bottom: 2rem;
      }

      .youtube-input {
        width: 100%;
        padding: 1.4rem 1.6rem;
        font-size: 1.6rem;
        border-radius: 8px;
        border: 2px solid #333;
        background: #111;
        color: #fff;
        margin-bottom: 1.2rem;
        font-family: inherit;
      }

      .youtube-input:focus {
        outline: none;
        border-color: #f02e2e;
      }

      .save-btn {
        padding: 1.2rem 2.4rem;
        background: #f02e2e;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 1.6rem;
        font-weight: 600;
        cursor: pointer;
        font-family: inherit;
        transition: background 0.3s;
      }

      .save-btn:hover {
        background: #c02020;
      }

      .save-success {
        color: #44ff88;
        font-size: 1.4rem;
        margin-left: 1.2rem;
        display: none;
      }

      .go-live-card {
        background: #1a1a1a;
        border-radius: 16px;
        padding: 3.2rem;
        text-align: center;
        margin-bottom: 2.4rem;
      }

      .go-live-btn {
        width: 100%;
        padding: 2rem;
        background: #f02e2e;
        color: #fff;
        border: none;
        border-radius: 12px;
        font-size: 2.4rem;
        font-weight: 700;
        cursor: pointer;
        font-family: inherit;
        transition: all 0.3s;
        letter-spacing: 2px;
      }

      .go-live-btn:hover {
        background: #c02020;
        transform: scale(1.02);
      }

      .go-live-btn.live {
        background: #222;
        color: #f02e2e;
        border: 2px solid #f02e2e;
      }

      .go-live-btn.live:hover {
        background: #1a0000;
      }

      .live-status-text {
        margin-top: 1.6rem;
        font-size: 1.4rem;
        color: #888;
      }

      .live-dot {
        display: inline-block;
        width: 1rem;
        height: 1rem;
        border-radius: 50%;
        background: #44ff88;
        margin-right: 0.6rem;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      /* ===================== */
      /* SHOWS MANAGER STYLES  */
      /* ===================== */
      .shows-card {
        background: #1a1a1a;
        border-radius: 16px;
        padding: 3.2rem;
        margin-bottom: 2.4rem;
      }

      .shows-card h3 {
        font-size: 1.8rem;
        margin-bottom: 0.4rem;
      }

      .shows-card .section-desc {
        font-size: 1.4rem;
        color: #888;
        margin-bottom: 2.4rem;
      }

      .show-form {
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
        margin-bottom: 2.4rem;
        padding-bottom: 2.4rem;
        border-bottom: 1px solid #2a2a2a;
      }

      .show-form input,
      .show-form select {
        width: 100%;
        padding: 1.2rem 1.6rem;
        font-size: 1.6rem;
        border-radius: 8px;
        border: 2px solid #333;
        background: #111;
        color: #fff;
        font-family: inherit;
      }

      .show-form input:focus,
      .show-form select:focus {
        outline: none;
        border-color: #f02e2e;
      }

      .show-form select option {
        background: #111;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.2rem;
      }

      .add-show-btn {
        width: 100%;
        padding: 1.4rem;
        background: #f02e2e;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 1.6rem;
        font-weight: 600;
        cursor: pointer;
        font-family: inherit;
        transition: background 0.3s;
      }

      .add-show-btn:hover {
        background: #c02020;
      }

      .shows-list {
        display: flex;
        flex-direction: column;
        gap: 1.6rem;
      }

      .show-admin-item {
        background: #111;
        border-radius: 12px;
        padding: 2rem;
        border: 1px solid #2a2a2a;
      }

      .show-admin-item.editing {
        border-color: #f02e2e;
      }

      .show-admin-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 1.6rem;
      }

      .show-admin-info h4 {
        font-size: 1.8rem;
        margin-bottom: 0.4rem;
      }

      .show-admin-info p {
        font-size: 1.4rem;
        color: #888;
      }

      .show-admin-actions {
        display: flex;
        gap: 0.8rem;
        flex-shrink: 0;
      }

      .edit-btn,
      .delete-btn,
      .save-edit-btn,
      .cancel-edit-btn {
        padding: 0.8rem 1.4rem;
        border: none;
        border-radius: 6px;
        font-size: 1.4rem;
        font-weight: 600;
        cursor: pointer;
        font-family: inherit;
        transition: all 0.3s;
      }

      .edit-btn {
        background: #2a2a2a;
        color: #fff;
      }

      .edit-btn:hover {
        background: #3a3a3a;
      }

      .delete-btn {
        background: transparent;
        color: #f02e2e;
        border: 1px solid #f02e2e;
      }

      .delete-btn:hover {
        background: #f02e2e;
        color: #fff;
      }

      .save-edit-btn {
        background: #f02e2e;
        color: #fff;
      }

      .save-edit-btn:hover {
        background: #c02020;
      }

      .cancel-edit-btn {
        background: #2a2a2a;
        color: #888;
      }

      .cancel-edit-btn:hover {
        color: #fff;
      }

      .show-edit-form {
        display: none;
        flex-direction: column;
        gap: 1.2rem;
        margin-top: 1.6rem;
        padding-top: 1.6rem;
        border-top: 1px solid #2a2a2a;
      }

      .show-edit-form.open {
        display: flex;
      }

      .show-edit-form input,
      .show-edit-form select {
        width: 100%;
        padding: 1rem 1.4rem;
        font-size: 1.5rem;
        border-radius: 8px;
        border: 2px solid #333;
        background: #0a0a0a;
        color: #fff;
        font-family: inherit;
      }

      .show-edit-form input:focus,
      .show-edit-form select:focus {
        outline: none;
        border-color: #f02e2e;
      }

      .show-img-preview {
        width: 100%;
        height: 12rem;
        object-fit: cover;
        border-radius: 8px;
        margin-top: 0.8rem;
        display: none;
      }

      .show-img-preview.visible {
        display: block;
      }

      .img-actions {
        display: flex;
        gap: 0.8rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .img-upload-label {
        padding: 0.8rem 1.4rem;
        background: #2a2a2a;
        color: #fff;
        border-radius: 6px;
        font-size: 1.4rem;
        cursor: pointer;
        transition: background 0.3s;
      }

      .img-upload-label:hover {
        background: #3a3a3a;
      }

      .remove-img-btn {
        padding: 0.8rem 1.4rem;
        background: transparent;
        color: #f02e2e;
        border: 1px solid #f02e2e;
        border-radius: 6px;
        font-size: 1.4rem;
        cursor: pointer;
        font-family: inherit;
        transition: all 0.3s;
      }

      .remove-img-btn:hover {
        background: #f02e2e;
        color: #fff;
      }

      .no-shows-msg {
        text-align: center;
        color: #555;
        font-size: 1.6rem;
        padding: 2rem 0;
      }

      .shows-saved-msg {
        color: #44ff88;
        font-size: 1.4rem;
        margin-left: 1.2rem;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="admin-container">
      <div class="admin-logo">MIKEY HARMS</div>

      <!-- LOGIN SCREEN -->
      <div class="login-box" id="loginBox">
        <h2>Admin Login</h2>
        <input
          type="password"
          class="login-input"
          id="passwordInput"
          placeholder="Enter password"
        />
        <button class="login-btn" onclick="login()">Login</button>
        <p class="login-error" id="loginError">
          Incorrect password. Try again.
        </p>
      </div>

      <!-- DASHBOARD -->
      <div class="dashboard" id="dashboard">
        <div class="dashboard-header">
          <h2>Live Dashboard</h2>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <!-- VISITOR COUNT -->
        <div class="visitor-card">
          <div class="visitor-icon">üë•</div>
          <div class="visitor-info">
            <h3>Currently on website</h3>
            <div class="visitor-count" id="visitorCount">‚Äî</div>
            <div class="visitor-label">active visitors right now</div>
          </div>
        </div>

        <!-- PLATFORM TOGGLES -->
        <div class="live-card">
          <h3>Platforms</h3>
          <div class="platform-row">
            <div class="platform-info">
              <span class="platform-icon">üéµ</span>
              <span class="platform-name">TikTok</span>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                id="tiktokToggle"
                onchange="updatePlatform('tiktok', this.checked)"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="platform-row">
            <div class="platform-info">
              <span class="platform-icon">üì∏</span>
              <span class="platform-name">Instagram</span>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                id="instagramToggle"
                onchange="updatePlatform('instagram', this.checked)"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="platform-row">
            <div class="platform-info">
              <span class="platform-icon">‚ñ∂Ô∏è</span>
              <span class="platform-name">YouTube</span>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                id="youtubeToggle"
                onchange="updatePlatform('youtube', this.checked)"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- YOUTUBE URL -->
        <div class="youtube-card">
          <h3>YouTube Live URL</h3>
          <p>
            Paste your StreamYard/YouTube live stream URL here so fans can watch
            on the website
          </p>
          <input
            type="text"
            class="youtube-input"
            id="youtubeUrl"
            placeholder="https://www.youtube.com/watch?v=..."
          />
          <button class="save-btn" onclick="saveYoutubeUrl()">Save URL</button>
          <span class="save-success" id="saveSuccess">‚úì Saved!</span>
        </div>

        <!-- GO LIVE BUTTON -->
        <div class="go-live-card">
          <button class="go-live-btn" id="goLiveBtn" onclick="toggleLive()">
            GO LIVE
          </button>
          <p class="live-status-text" id="liveStatusText">
            You are currently offline
          </p>
        </div>

        <!-- SHOWS MANAGER -->
        <div class="shows-card">
          <h3>üé§ Shows Manager</h3>
          <p class="section-desc">
            Add, edit, or remove shows. Changes appear on the website instantly.
          </p>

          <!-- Add New Show Form -->
          <div class="show-form">
            <input
              type="text"
              id="new-venue"
              placeholder="Venue name (e.g. Subterranean)"
            />
            <div class="form-row">
              <input
                type="text"
                id="new-date"
                placeholder="Date (e.g. February 20th)"
              />
              <input
                type="text"
                id="new-month"
                placeholder="Month (e.g. February)"
              />
            </div>
            <input
              type="text"
              id="new-address"
              placeholder="Address (e.g. 2011 W. North Avenue)"
            />
            <input
              type="text"
              id="new-age"
              placeholder="Age restriction (e.g. 17+ or 21+)"
            />
            <input
              type="text"
              id="new-ticket-url"
              placeholder="Ticket link URL (optional)"
            />
            <input
              type="text"
              id="new-img-url"
              placeholder="Image URL (optional - paste a link to venue photo)"
            />
            <button class="add-show-btn" onclick="addShow()">+ Add Show</button>
            <span class="shows-saved-msg" id="showAddedMsg">‚úì Show added!</span>
          </div>

          <!-- Existing Shows List -->
          <div class="shows-list" id="shows-list">
            <p class="no-shows-msg">No shows yet. Add one above!</p>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
        onValue,
        push,
        onDisconnect,
        remove,
        update,
      } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDiB96LIN28Wa2ef0uJjV8nFy4u7h-9skY",
        authDomain: "mikey-harms-website.firebaseapp.com",
        databaseURL: "https://mikey-harms-website-default-rtdb.firebaseio.com",
        projectId: "mikey-harms-website",
        storageBucket: "mikey-harms-website.firebasestorage.app",
        messagingSenderId: "359019811623",
        appId: "1:359019811623:web:87b7189fff0a27ea5a4f02",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      const ADMIN_PASSWORD = "danisfat123ed";

      window.login = function () {
        const input = document.getElementById("passwordInput").value;
        if (input === ADMIN_PASSWORD) {
          document.getElementById("loginBox").style.display = "none";
          document.getElementById("dashboard").style.display = "block";
          loadDashboard();
        } else {
          document.getElementById("loginError").style.display = "block";
        }
      };

      document
        .getElementById("passwordInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") window.login();
        });

      window.logout = function () {
        document.getElementById("loginBox").style.display = "block";
        document.getElementById("dashboard").style.display = "none";
        document.getElementById("passwordInput").value = "";
      };

      function loadDashboard() {
        // Live status
        onValue(ref(db, "liveStatus"), (snapshot) => {
          const data = snapshot.val() || {};
          document.getElementById("tiktokToggle").checked =
            data.tiktok || false;
          document.getElementById("instagramToggle").checked =
            data.instagram || false;
          document.getElementById("youtubeToggle").checked =
            data.youtube || false;
          if (data.youtubeUrl)
            document.getElementById("youtubeUrl").value = data.youtubeUrl;

          const isLive = data.isLive || false;
          const btn = document.getElementById("goLiveBtn");
          const statusText = document.getElementById("liveStatusText");
          if (isLive) {
            btn.textContent = "END STREAM";
            btn.classList.add("live");
            statusText.innerHTML =
              '<span class="live-dot"></span> You are currently LIVE';
          } else {
            btn.textContent = "GO LIVE";
            btn.classList.remove("live");
            statusText.textContent = "You are currently offline";
          }
        });

        // Visitors
        onValue(ref(db, "visitors"), (snapshot) => {
          const data = snapshot.val() || {};
          document.getElementById("visitorCount").textContent =
            Object.keys(data).length;
        });

        // Shows
        onValue(ref(db, "shows"), (snapshot) => {
          const data = snapshot.val() || {};
          const list = document.getElementById("shows-list");
          list.innerHTML = "";

          const entries = Object.entries(data).sort(
            (a, b) => (a[1].order || 0) - (b[1].order || 0),
          );

          if (entries.length === 0) {
            list.innerHTML =
              '<p class="no-shows-msg">No shows yet. Add one above!</p>';
            return;
          }

          entries.forEach(([id, show]) => {
            const item = document.createElement("div");
            item.className = "show-admin-item";
            item.id = `show-item-${id}`;
            item.innerHTML = `
              <div class="show-admin-top">
                <div class="show-admin-info">
                  <h4>${show.venue}</h4>
                  <p>${show.date} &bull; ${show.address} &bull; ${show.age}</p>
                </div>
                <div class="show-admin-actions">
                  <button class="edit-btn" onclick="toggleEdit('${id}')">Edit</button>
                  <button class="delete-btn" onclick="deleteShow('${id}')">Delete</button>
                </div>
              </div>
              ${show.imgUrl ? `<img src="${show.imgUrl}" class="show-img-preview visible" id="preview-${id}" />` : `<img class="show-img-preview" id="preview-${id}" />`}
              <div class="show-edit-form" id="edit-form-${id}">
                <input type="text" id="edit-venue-${id}" value="${show.venue}" placeholder="Venue name" />
                <div class="form-row">
                  <input type="text" id="edit-date-${id}" value="${show.date}" placeholder="Date" />
                  <input type="text" id="edit-month-${id}" value="${show.month}" placeholder="Month" />
                </div>
                <input type="text" id="edit-address-${id}" value="${show.address}" placeholder="Address" />
                <input type="text" id="edit-age-${id}" value="${show.age}" placeholder="Age restriction" />
                <input type="text" id="edit-ticket-${id}" value="${show.ticketUrl || ""}" placeholder="Ticket URL" />
                <input type="text" id="edit-img-${id}" value="${show.imgUrl || ""}" placeholder="Image URL" oninput="previewImg('${id}')" />
                <div style="display:flex; gap:1.2rem; margin-top:0.4rem;">
                  <button class="save-edit-btn" onclick="saveEdit('${id}', ${show.order || 0})">Save Changes</button>
                  <button class="cancel-edit-btn" onclick="toggleEdit('${id}')">Cancel</button>
                </div>
              </div>
            `;
            list.appendChild(item);
          });
        });
      }

      window.addShow = function () {
        const venue = document.getElementById("new-venue").value.trim();
        const date = document.getElementById("new-date").value.trim();
        const month = document.getElementById("new-month").value.trim();
        const address = document.getElementById("new-address").value.trim();
        const age = document.getElementById("new-age").value.trim();
        const ticketUrl = document
          .getElementById("new-ticket-url")
          .value.trim();
        const imgUrl = document.getElementById("new-img-url").value.trim();

        if (!venue || !date || !month || !address || !age) {
          alert(
            "Please fill in venue, date, month, address, and age restriction.",
          );
          return;
        }

        const newRef = push(ref(db, "shows"));
        set(newRef, {
          venue,
          date,
          month,
          address,
          age,
          ticketUrl,
          imgUrl,
          order: Date.now(),
        });

        // Clear form
        [
          "new-venue",
          "new-date",
          "new-month",
          "new-address",
          "new-age",
          "new-ticket-url",
          "new-img-url",
        ].forEach((id) => (document.getElementById(id).value = ""));

        const msg = document.getElementById("showAddedMsg");
        msg.style.display = "inline";
        setTimeout(() => (msg.style.display = "none"), 2000);
      };

      window.deleteShow = function (id) {
        if (confirm("Delete this show?")) {
          remove(ref(db, `shows/${id}`));
        }
      };

      window.toggleEdit = function (id) {
        const form = document.getElementById(`edit-form-${id}`);
        const item = document.getElementById(`show-item-${id}`);
        form.classList.toggle("open");
        item.classList.toggle("editing");
      };

      window.saveEdit = function (id, order) {
        const venue = document.getElementById(`edit-venue-${id}`).value.trim();
        const date = document.getElementById(`edit-date-${id}`).value.trim();
        const month = document.getElementById(`edit-month-${id}`).value.trim();
        const address = document
          .getElementById(`edit-address-${id}`)
          .value.trim();
        const age = document.getElementById(`edit-age-${id}`).value.trim();
        const ticketUrl = document
          .getElementById(`edit-ticket-${id}`)
          .value.trim();
        const imgUrl = document.getElementById(`edit-img-${id}`).value.trim();

        update(ref(db, `shows/${id}`), {
          venue,
          date,
          month,
          address,
          age,
          ticketUrl,
          imgUrl,
          order,
        });
        toggleEdit(id);
      };

      window.previewImg = function (id) {
        const url = document.getElementById(`edit-img-${id}`).value.trim();
        const preview = document.getElementById(`preview-${id}`);
        if (url) {
          preview.src = url;
          preview.classList.add("visible");
        } else {
          preview.classList.remove("visible");
        }
      };

      window.updatePlatform = function (platform, value) {
        set(ref(db, `liveStatus/${platform}`), value);
      };

      window.saveYoutubeUrl = function () {
        const url = document.getElementById("youtubeUrl").value;
        set(ref(db, "liveStatus/youtubeUrl"), url);
        const success = document.getElementById("saveSuccess");
        success.style.display = "inline";
        setTimeout(() => (success.style.display = "none"), 2000);
      };

      window.toggleLive = function () {
        const btn = document.getElementById("goLiveBtn");
        const isCurrentlyLive = btn.classList.contains("live");
        set(ref(db, "liveStatus/isLive"), !isCurrentlyLive);
      };

      // Track visitor
      const visitorRef = push(ref(db, "visitors"));
      set(visitorRef, { active: true, timestamp: Date.now() });
      onDisconnect(visitorRef).remove();
    </script>
  </body>
</html>
